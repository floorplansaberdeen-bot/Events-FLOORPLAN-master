<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Floorplan Admin</title>
  <style>
    :root{
      --accentText:rgb(213,109,50);
      --bg:#ffffff; --card:#ffffff; --border:#e9e9e9; --text:#111; --muted:rgb(213,109,50);
      --avail: rgba(213,109,50,0.75); --sold: rgba(230,59,59,0.75); --shadow: 0 12px 30px rgba(0,0,0,.12);
      --dot: 10px; --line:rgba(110,110,110,.9); --safe: env(safe-area-inset-bottom, 0px);
      --ok:#16a34a; --danger:#dc2626;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--text); }
    header{
      padding:14px 16px; display:flex; align-items:center; justify-content:space-between; gap:12px;
      border-bottom:1px solid var(--border); flex-wrap:wrap; position:sticky; top:0; z-index:50; background:var(--bg);
    }
    header .title{ font-weight:900; font-size:18px; display:flex; align-items:center; gap:10px; }
    .lockState{ font-size:12px; font-weight:900; padding:4px 10px; border-radius:999px; border:1px solid var(--border); color:var(--muted); }
    .lockState.unlocked{ color:#065f46; border-color:#bbf7d0; background:#ecfdf5; }
    header .tools{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    header input{ padding:10px 12px; border-radius:12px; border:1px solid var(--border); min-width: 220px; font-weight:700; }
    button{ border:1px solid var(--border); background:#fff; padding:10px 14px; border-radius:12px; font-weight:800; cursor:pointer; }
    button.primary{ background:var(--ok); color:#fff; border-color:rgba(0,0,0,.08); }
    button.danger{ background:var(--danger); color:#fff; border-color:rgba(0,0,0,.08); }
    button:disabled{ opacity:.45; cursor:not-allowed; }
    main{ padding:16px; display:grid; grid-template-columns: 1.15fr 0.85fr; gap:16px; align-items:start; }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:16px; box-shadow: 0 1px 0 rgba(0,0,0,.02); }
    .cardHead{ padding:10px 12px; font-weight:900; border-bottom:1px solid var(--border); }
    .planCard{ overflow:hidden; }
    .planBody{ padding:12px; }
    .planStack{ position:relative; border-radius:14px; overflow:hidden; background:#fff; }
    .planWrap{ position:relative; border-radius:14px; overflow:hidden; background:#fff; min-height:420px; }
    .svgHost{ width:100%; height:auto; display:block; }
    .labelBay{ background:#fff; border-top:1px solid var(--border); padding:12px; min-height:72px; }
    .lozenge{ display:inline-block; background:#fff; border-radius:999px; padding:12px 16px; box-shadow: var(--shadow); border:1px solid rgba(0,0,0,.08); max-width: 360px; }
    .lozStand{ font-size:28px; font-weight:900; line-height:1.1; }
    .lozCompany{ margin-top:4px; font-size:16px; font-weight:800; opacity:.9; }
    .calloutSvg{ position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; }
    .legend{ padding:10px 12px; display:flex; gap:10px; align-items:center; border-top:1px solid var(--border); }
    .pill{ display:flex; align-items:center; gap:8px; border:1px solid var(--border); padding:6px 10px; border-radius:999px; font-weight:800; font-size:13px; }
    .sw{ width:10px; height:10px; border-radius:999px; display:inline-block; }
    .zoomCard{ margin:12px; }
    .zoomBody{ padding:12px; }
    .zoomWrap{ position:relative; border:1px solid var(--border); border-radius:14px; overflow:hidden; min-height:240px; background:#fff; }
    .zoomSvgHost{ width:100%; height:auto; display:block; }
    .zoomRing{ position:absolute; border:4px solid rgba(0,0,0,.75); border-radius:999px; pointer-events:none; box-shadow: 0 6px 18px rgba(0,0,0,.12); display:none; }
    .side{ padding:12px; display:flex; flex-direction:column; gap:12px; }
    .panel{ border:1px solid var(--border); border-radius:14px; background:#fff; }
    .panelPad{ padding:12px; }
    label{ display:block; font-weight:800; font-size:12px; color:var(--muted); margin-bottom:6px; }
    .formRow{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    input, select{ width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--border); font-weight:700; }
    .btnRow{ display:flex; gap:10px; }
    .btnRow button{ flex:1; }
    .tableTools{ padding:10px; display:flex; gap:10px; align-items:center; }
    .tableTools input{ flex:1; }
    .countLine{ padding:0 12px 10px; color:var(--muted); font-weight:800; }
    .tableWrap{ border:1px solid var(--border); border-radius:14px; overflow:auto; max-height: calc(100vh - 210px); padding-bottom: calc(14px + var(--safe)); }
    table{ width:100%; border-collapse:collapse; font-size:13px; }
    th, td{ padding:10px 10px; border-top:1px solid #f0f0f0; text-align:left; }
    th{ background:#fafafa; border-top:none; font-size:12px; color:var(--muted); position:sticky; top:0; }
    tr.active{ background:#f5f8ff; outline:2px solid #c9d5ff; outline-offset:-2px; }
    .badge{ display:inline-flex; align-items:center; padding:3px 8px; border-radius:999px; font-weight:900; font-size:12px; border:1px solid var(--border); }
    .bSold{ color:#b40000; border-color:#ffd0d0; background:#fff5f5; }
    .bAvail{ color:#6b3a0f; border-color:#f2dfcf; background:#fff7f0; }
    .toast{ position:fixed; left:16px; right:16px; bottom:16px; background:#111; color:#fff; padding:12px 14px; border-radius:14px; display:none; z-index:999; box-shadow: var(--shadow); align-items:center; justify-content:space-between; gap:12px; }
    .toast .msg{ font-weight:800; font-size:13px; line-height:1.3; }
    .toast .actions{ display:flex; gap:10px; }
    .toast button{ background:#fff; }
    .progressOverlay{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:1000; padding:16px; }
    .progressCard{ width:min(520px, 100%); background:#fff; border-radius:18px; border:1px solid rgba(0,0,0,.12); box-shadow: var(--shadow); padding:16px; }
    .progressTitle{ font-weight:950; font-size:16px; }
    .progressMsg{ margin-top:6px; color:var(--muted); font-weight:800; font-size:13px; }
    .progressBar{ margin-top:12px; height:10px; border-radius:999px; background:#efefef; overflow:hidden; }
    #progressBarFill{ height:100%; width:0%; background:rgba(0,0,0,.8); }
    @media (max-width: 980px){ main{ grid-template-columns: 1fr; } .tableWrap{ max-height: none; } }
    @media (max-width: 640px){
      /* Make sure the page (not an inner wrapper) is the scrolling container so sticky works on mobile */
      html, body{ height:auto; }
      body{ overflow-y:auto; }

      main{
        padding:12px; gap:12px;
        grid-template-columns: 1fr;
        overflow: visible;
      }

      header input{ min-width: 170px; width: 100%; }

      /* Keep the plan card pinned at the top */
      .planCard{
        position: -webkit-sticky;
        position: sticky;
        top: 0;
        z-index: 50;
        background: var(--bg);
      }

      /* Prevent overflow on common wrappers from breaking sticky */
      .planCard, .planBody, .planStack, .planWrap{ overflow: visible; }

      /* Compact plan on phones */
      .planWrap{ min-height:0; max-height:42vh; }

      #svgHost{ height:100%; }
      #svgHost > svg{ width:100%; height:100%; }

      .planBody{ padding:10px; }
      .labelBay{ padding:10px; min-height:56px; }

      header{ padding:10px 12px; }
      button{ padding:8px 10px; border-radius:12px; }

      .actions,.btnRow{ flex-wrap:wrap; gap:8px; }

      /* Ensure the list area scrolls under the pinned plan */
      .tableWrap{
        max-height: calc(100vh - 46vh - 140px);
        overflow:auto;
        -webkit-overflow-scrolling: touch;
      }

      /* Hide the zoom card on mobile (as before) */
      .zoomCard{ display:none; }
    }
  
  /* heading orange */
  h1, h2, h3 { color: #d56d32; }

  /* v38 typography */
  h1, h2, h3 { color: #d56d32; }
  b, strong, th { color: #d56d32; }
  /* v38 callout line enforcement */
  #calloutSvg line, #calloutSvg circle { stroke: rgba(70,70,70,.85) !important; fill: rgba(70,70,70,.90) !important; }

  /* v39 orange sweep */
  .cardHead, .cardTitle, .sectionTitle, .topTitle, .brand, .pageTitle,
  .title, .headerTitle, .panelTitle { color: var(--accentText) !important; }
  b, strong, th { color: var(--accentText) !important; }
  /* callout line/dot */
  #calloutSvg line { stroke: rgba(110,110,110,.9) !important; }
  #calloutSvg circle { stroke: rgba(110,110,110,.9) !important; fill: rgba(110,110,110,.95) !important; }
</style>
  <link rel="icon" href="./favicon.ico">
</head>
<body>
  <header>
    <div class="title">Floorplan Admin <span id="lockState" class="lockState">ðŸ”’ Locked</span></div>
    <div class="tools">
      <div style="color:var(--muted); font-weight:800;">Synced: <span id="syncedAt">â€”</span></div>
      <div style="display:flex; gap:10px; align-items:center;">
        <div style="font-weight:900;">Event name</div>
        <input id="eventName" placeholder="New Event" />
        <button id="setEventBtn" class="primary" title="Save event name">Set</button>
      </div><button id="pauseBtn">Pause sync</button>
      <button id="exportBtn">Export CSV</button>
      <button id="importBtn">Import CSV</button>
      <button class="danger" id="resetBtn">Reset all</button>
      <button id="undoBtn" disabled title="Undo last change">Undo</button>
    </div>
      <div class="row" style="align-items:center; gap:12px; margin-top:10px;">
        <label style="display:flex; align-items:center; gap:10px; user-select:none;">
          <input id="viewerNamesToggle" type="checkbox" style="width:18px; height:18px;"/>
          <span style="font-weight:600;">Include company names in Exhibitor Viewer</span>
        </label>
        <span id="viewerNamesState" class="muted"></span>
      </div>
      <div class="row" style="gap:10px; margin-top:8px;">
        <a id="openPublicBtn" class="btn btn-light" href="index.html" target="_blank" rel="noopener">Public View</a>
        <a id="openViewerBtn" class="btn btn-light" href="viewer.html" target="_blank" rel="noopener">Exhibitor&#39;s View</a>
      </div>


  </header>

  <main>
    <section class="card planCard">
      <div class="cardHead">Plan</div>
      <div class="planBody">
        <div class="planStack" id="planStack">
          <div class="planWrap" id="planWrap">
            <div id="svgHost" class="svgHost"></div>
          </div>
          <div class="labelBay" id="labelBay">
            <div class="lozenge" id="lozenge" style="display:none;">
              <div class="lozStand" id="lozStand">â€”</div>
              <div class="lozCompany" id="lozCompany" style="display:none;"></div>
            </div>
          </div>
          <svg class="calloutSvg" id="calloutSvg" aria-hidden="true"></svg>
        </div>
      </div>
      <div class="legend">
        <div class="pill"><span class="sw" style="background:var(--sold)"></span>Sold</div>
        <div class="pill"><span class="sw" style="background:var(--avail)"></span>Available</div>
      </div>

      <section class="card zoomCard">
        <div class="cardHead">Zoom</div>
        <div class="zoomBody">
          <div class="zoomWrap" id="zoomWrap">
            <div id="zoomSvgHost" class="zoomSvgHost"></div>
            <div class="zoomRing" id="zoomRing"></div>
          </div>
          <div style="color:var(--muted); font-size:13px; font-weight:800; margin-top:10px;">Select a stand to zoom in.</div>
        </div>
      </section>
    </section>

    <aside class="card side">
      <div class="panel" id="selectedCard">
        <div class="panelPad">
          <div style="font-weight:900; margin-bottom:10px;">Selected Stand</div>
          <div style="margin-bottom:10px;">
            <label>Stand ID</label>
            <input id="standId" disabled />
          </div>
          <div class="formRow" style="margin-bottom:10px;">
            <div>
              <label>Status</label>
              <select id="status">
                <option value="available">Available</option>
                <option value="sold">Sold</option>
              </select>
            </div>
            <div>
              <label>Company (sold only)</label>
              <input id="company" placeholder="Company nameâ€¦" />
            </div>
          </div>
          <div class="btnRow">
            <button id="saveBtn" class="primary">Save</button>
            <button id="markAvailBtn" class="danger">Mark Available</button>
          </div>
          <div style="color:var(--muted); font-size:13px; font-weight:800; margin-top:10px;">Click a stand on the plan or in the list to edit.</div>
        </div>
      </div>

      <div class="panel">
        <div class="cardHead">Stands</div>
        <div class="tableTools">
          <input id="search" placeholder="Search stand or companyâ€¦" />
          <select id="filter" style="width:120px;">
            <option value="all">All</option>
            <option value="sold">Sold</option>
            <option value="available">Available</option>
          </select>
        </div>
        <div class="countLine"><span id="count">0</span> / <span id="total">0</span></div>
        <div class="tableWrap">
          <table>
            <thead>
              <tr><th style="width:90px;">Stand</th><th style="width:120px;">Status</th><th>Company</th></tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </aside>
  </main>

  <div class="progressOverlay" id="progressOverlay" aria-hidden="true">
    <div class="progressCard">
      <div class="progressTitle" id="progressTitle">Updatingâ€¦</div>
      <div class="progressMsg" id="progressMsg">Please keep this tab open.</div>
      <div class="progressBar"><div id="progressBarFill"></div></div>
    </div>
  </div>

  <div class="toast" id="toast">
    <div class="msg" id="toastMsg">Can't reach the backend right now.</div>
    <div class="actions">
            <button id="hideToastBtn">Hide</button>
    </div>
  </div>

  <script src="./shared.js?v=20260214b"></script>
  <script src="./admin.js?v=20260214b" defer></script>

  <!-- Password modal -->
  <div id="pwdModal" style="position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:9999;">
    <div style="width:min(420px,92vw); background:#fff; border-radius:16px; box-shadow: 0 20px 60px rgba(0,0,0,.25); border:1px solid var(--border); padding:18px;">
      <div style="font-weight:900; font-size:18px; margin-bottom:8px; color:var(--accentText);">Admin password</div>
      <div id="pwdReason" style="color:#333; font-weight:700; margin-bottom:12px;">Password required</div>
      <input id="pwdInput" type="password" autocomplete="current-password"
        style="width:100%; padding:12px 12px; border:1px solid var(--border); border-radius:12px; font-size:16px; outline:none;" />
      <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:14px;">
        <button id="pwdCancel" class="btn">Cancel</button>
        <button id="pwdOk" class="btn primary">Unlock</button>
      </div>
    </div>
  </div>

</body>
</html>
